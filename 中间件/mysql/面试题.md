### mysql索引
    
#### B+树和B树的异同

B+树和B树都是一种常用的数据结构，用于在磁盘、内存等存储设备上实现快速查找和排序等操作，二者的主要区别如下：

1. 节点结构：B+树中的非叶子节点只有索引信息，不存储真正的数据记录，数据记录只存储在叶子节点中；而B树的非叶子节点上也可以存储数据记录。

2. 叶子节点：B+树中的叶子节点按照关键字大小顺序串联起来，可以方便进行区间查找等操作，并且所有的叶子节点都连接成了一个单链表；而B树的叶子节点没有这个特性，需要进行遍历。

3. 应用场景：B树适用于需要频繁插入和删除的情况，如文件系统和数据库索引；而B+树适用于只需要进行单次查询的情况，如键值数据库和文件存储系统。

##### 和跳表的区别

1. 数据存储方式：B+树主要用于外部存储，即硬盘等永久性存储设备，其节点的大小通常等于或者大于页的大小，而跳表则用于内存中，其节点的大小通常小于页的大小。

2. 节点的顺序：B+树节点之间的顺序是按照键值的大小关系进行排列，而跳表节点之间的顺序则按照数据的插入顺序进行排列。

3. 节点的连续性：B+树的相邻节点是通过指针连接起来的，而跳表中的节点则是通过链表连接的。

4. 实现方法：B+树通常使用指针和深度优先遍历方法进行实现，而跳表则使用多级索引和广度优先遍历方法进行实现。

5. 应用场景：B+树适合在磁盘上实现索引，如数据库和文件系统，而跳表适合用于内存中的实现，如Redis中的有序集合。


#### 索引类型

1. 普通索引
2. 唯一索引：值唯一，允许为空
3. 主键索引：值唯一，不允许为空
4. 全文索引：仅可用于 MyISAM 表， 用于在一篇文章中，检索文本信息的, 针对较大的数据，生成全文索引很耗时耗空间
5. 联合索引：最左前缀


#### 聚簇索引和普通索引

InnoDB 普通索引 的叶子节点存储主键值。

`注意：只有 InnoDB 普通索引才存储主键值，MyISAM 的二级索引都是直接指向数据块的。`

InnoDB 聚集索引 的叶子节点存储行记录，因此，InnoDB 必须要有，且只有一个聚集索引：

如果表定义了主键，则主键就是聚集索引；

如果表没有定义主键，则第一个 not null 的 unique 列是聚集索引；

否则，InnoDB 会创建一个隐藏的 row-id 作为聚集索引；

`注意：所以主键查询非常快，直接定位行记录。`

#### B+树索引结构

#### 索引失效的情况

`= < > <= >= BETWEEN IN 以及LIKE xxx%会走索引`
1. 联合索引没走最左列字段
2. like以%开头
3. or的每个字段都要有索引
4. 字段类型转换 如：存储的字符串，那查询就要用引号引起来

### mysql事务

- 原子性
- 隔离性
- 一致性
- 持久性

#### mysql事务特性

#### 隔离级别
- 读未提交
- 读已提交
- 可重复读
- 串行化
   
#### 默认隔离级别 rr

#### 解决幻读
没有彻底解决，解决了快照读的幻读情况，没有解决当前读的 问题：A事务更新所有小于5的，B事务插入小于5的记录，A事务也能更新到该记录。
串行化解决

### mysql锁

#### 行锁

#### 表锁

#### 共享锁
lock in share mode
#### 排它锁
for update

### 集群

    主从同步

### 问题

#### 深分页

本质是回表的问题，聚簇索引和普通索引的区别

通过二级索引查到主键值（找出所有 sn='XD12345678' 的 id)。
再根据查到的主键值通过主键索引找到相应的数据块（根据 id 找出对应的数据块内容）。
根据 offset 的值，查询 10010 次主键索引的数据，最后将之前的 10000 条丢弃，取出最后 10 条。

因为我们要查询 o1.*，前边丢弃的 10000 条数据，经过大量回表操作，造成了大量的 I/O 消耗，浪费了很多性能，导致查询时间变得很长。

```SQL
SELECT o1.* FROM orders WHERE sn='XD12345678' LIMIT 10000,10
```

```SQL
SELECT o1.* FROM orders o1
INNER JOIN (SELECT id FROM orders WHERE sn='XD12345678' LIMIT 10000,10) o2
ON o1.id = o2.id;
```